---
molecule:
  test:
    sequence:
      - destroy
      - create
      - converge
      - verify
#      - destroy

ansible:
  playbook: tests/playbook.yml
  config_file: tests/ansible.cfg
  inventory_file: tests/inventory
  sudo: True
  # with 'vv' I got a strange UnicodeDecodeError -> https://github.com/metacloud/molecule/issues/702
  verbose: False
  check: False
#  raw_env_vars:
#      LD_LIBRARY_PATH: /lib-override

#  group_vars:
#    all:
#    - java_home: /usr/lib/jvm/java-8-openjdk-amd64
#      java_packages:
#       - openjdk-8-jdk
#      java_openjdk_ppa_repos_support: true
##    zookeeper_hosts:
##    - zookeeper_client_port: "2181"
#      zookeeper_version: 3.4.8
#      # used by other role defaults (just grep for it)
#      #zookeeper_hostnames : "{{ groups.zookeeper_hosts | join(':' + zookeeper_client_port + ',')  }}:{{ zookeeper_client_port  }}"
#      # used in the role: ansible-zookeepr
#      zookeeper_hosts: "{{ groups['zookeeper_hosts'] }}"
#      zookeeper_register_path_env: true
#      zookeeper_debian_apt_install: true
#      zookeeper_debian_apt_repositories:
#       - repository_url: "ppa:ufscar/zookeeper"
#         distro_version: "14.04"
#  host_vars:
#    zookeeper03:
#    - zookeeper_version: 3.4.8
#      zookeeper_hosts: "{{ groups['zookeeper_hosts'] }}"
##      zookeeper_register_path_env: true
#      zookeeper_debian_apt_install: false

      # custom zookeeper (bin) dir (role default is in /opt )
#      zookeeper_dir: /usr/local/zookeeper-{{zookeeper_version}}
#      zookeeper_tarball_dir: /tmp/

dependency:
  name: galaxy
  requirements_file: tests/requirements.yml
  options:
    ignore-certs: True
    ignore-errors: True
driver:
  name: docker
# Below we are creating 3 diff. docker containers with slightly differen setups
# 1. Ubuntu 16.04, with zookeeper deployed using v3.4.8 deb pkg (official repos)
# 2. Ubuntu 14.04, with zookeeper deployed using v3.4.8 deb pkg (extra ppa)
# 3. Ubuntu 14.04, with zookeeper deployed using v3.4.8 from (official) tarball
# Note: With molecule v2 we expect to have .travis 'matrix' style testing powers
docker:
  containers:
    - name: zookeeper01
      image: solita/ubuntu-systemd
      image_version: 16.04
      privileged: True
      ansible_groups:
        - zookeeper_hosts
    - name: zookeeper02
      # following image works only, when 'systemd' is disabled (see playbook tasks)
      image: ubuntu-upstart
      image_version: 14.04
      privileged: True
      ansible_groups:
        - zookeeper_hosts
    - name: zookeeper03
      image: ubuntu-upstart
      image_version: 14.04
      privileged: True
      ansible_groups:
        - zookeeper_hosts

verifier:
  name: testinfra
  options:
    verbose: true
